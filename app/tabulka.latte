{layout 'layout.latte'}
{varType array $res}
{varType string $orderBy}
{varType string $direction}
{varType ?string $successMessage}
{varType int $totalCount}
{varType int $markedCount}
{block title}Tabulka dat{/block}
{block body}
   <div class="container">
      {if $successMessage}
         <div class="alert alert-success">
            <strong>âœ… ÃšspÄ›ch!</strong> {$successMessage}
         </div>
      {/if}

      <!-- Page Header -->
      <div style="margin: 2rem 0;">
         <h1 style="margin-bottom: 0.5rem;">ğŸ“Š SprÃ¡va zÃ¡znamÅ¯</h1>
         <p style="color: var(--gray-600);">InteraktivnÃ­ tabulka s pokroÄilÃ½mi funkcemi pro sprÃ¡vu dat</p>
      </div>

      <!-- Statistics Cards -->
      <div class="stats">
         <div class="stat-card">
            <div class="stat-value" id="totalCount">{$totalCount}</div>
            <div class="stat-label">Celkem zÃ¡znamÅ¯</div>
         </div>
         <div class="stat-card">
            <div class="stat-value" id="markedCount">{$markedCount}</div>
            <div class="stat-label">OznaÄeno</div>
         </div>
         <div class="stat-card">
            <div class="stat-value">{round(($markedCount / max($totalCount, 1)) * 100)}%</div>
            <div class="stat-label">OznaÄeno (%)</div>
         </div>
         <div class="stat-card">
            <div class="stat-value">ğŸ¯</div>
            <div class="stat-label">AktivnÃ­</div>
         </div>
      </div>

      <!-- Actions Header -->
      <div class="actions-header">
         <div class="actions">
            <a href="/download" class="btn btn-primary">
               ğŸ“¥ Importovat data
            </a>
            <button class="btn btn-secondary" id="clearMarks" v-on:click="clearAllMarks()">
               ğŸ—‘ï¸ Vymazat oznaÄenÃ­
            </button>
            <div class="btn-group">
               <button class="btn btn-success btn-sm" onclick="exportData('csv')">
                  ğŸ’¾ Exportovat CSV
               </button>
               <button class="btn btn-success btn-sm" onclick="exportData('json')">
                  ğŸ’¾ Exportovat JSON
               </button>
            </div>
         </div>
         <div class="stats-info hide-mobile">
            <span>Å˜azeno podle: <strong>{$orderBy}</strong></span>
            <span class="separator">|</span>
            <span>SmÄ›r: <strong>{$direction|upper}</strong></span>
         </div>
      </div>

      <!-- Data Table -->
      <div class="card">
         <table class="data-table">
            <thead>
               <tr>
                  <th class="sortable {$orderBy === 'id' ? 'active' : ''}" data-column="id">
                     <a href="?order=id&dir={$orderBy === 'id' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>ğŸ”— ID</span>
                        <span class="sort-icon">{if $orderBy === 'id'}{$direction === 'ASC' ? 'â†‘' : 'â†“'}{else}â†•{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'jmeno' ? 'active' : ''}" data-column="jmeno">
                     <a href="?order=jmeno&dir={$orderBy === 'jmeno' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>ğŸ‘¤ JmÃ©no</span>
                        <span class="sort-icon">{if $orderBy === 'jmeno'}{$direction === 'ASC' ? 'â†‘' : 'â†“'}{else}â†•{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'prijmeni' ? 'active' : ''}" data-column="prijmeni">
                     <a href="?order=prijmeni&dir={$orderBy === 'prijmeni' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>ğŸ“› PÅ™Ã­jmenÃ­</span>
                        <span class="sort-icon">{if $orderBy === 'prijmeni'}{$direction === 'ASC' ? 'â†‘' : 'â†“'}{else}â†•{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'datum' ? 'active' : ''}" data-column="datum">
                     <a href="?order=datum&dir={$orderBy === 'datum' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>ğŸ“… Datum</span>
                        <span class="sort-icon">{if $orderBy === 'datum'}{$direction === 'ASC' ? 'â†‘' : 'â†“'}{else}â†•{/if}</span>
                     </a>
                  </th>
                  <th style="width: 80px; text-align: center;">
                     <span>ğŸ¯ Status</span>
                  </th>
               </tr>
            </thead>
            <tbody>
            {foreach $res as $row}
               <tr data-id="{$row['id']}" class="{$row['is_marked'] ? 'row-marked' : ''}" style="cursor: pointer;">
                  <td style="font-weight: 500; color: var(--primary);">#{$row['id']}</td>
                  <td style="font-weight: 500;">{$row['jmeno']}</td>
                  <td>{$row['prijmeni']}</td>
                  <td style="color: var(--gray-600);">
                     {if $row['datum']}
                        {$row['datum']|date:'j.n.Y'}
                     {else}
                        <em style="color: var(--gray-400);">Neuvedeno</em>
                     {/if}
                  </td>
                  <td style="text-align: center;">
                     {if $row['is_marked']}
                        <span style="color: var(--primary); font-size: 1.2em;" title="OznaÄeno">âœ…</span>
                     {else}
                        <span style="color: var(--gray-300); font-size: 1.2em;" title="NeoznaÄeno">â­•</span>
                     {/if}
                  </td>
               </tr>
            {/foreach}
            {if count($res) === 0}
               <tr>
                  <td colspan="5" style="text-align: center; padding: 3rem; color: var(--gray-500);">
                     <div style="font-size: 3rem; margin-bottom: 1rem;">ğŸ“­</div>
                     <strong>Å½Ã¡dnÃ¡ data k zobrazenÃ­</strong><br>
                     <em>Importujte data pomocÃ­ tlaÄÃ­tka "Importovat data"</em>
                  </td>
               </tr>
            {/if}
            </tbody>
         </table>
      </div>

      <!-- Help Text -->
      <div class="card" style="margin-top: 1.5rem; background-color: var(--gray-50); border-left: 4px solid var(--info);">
         <h4 style="margin-top: 0; color: var(--info);">ğŸ’¡ NÃ¡povÄ›da</h4>
         <ul style="margin-bottom: 0; padding-left: 1.5rem;">
            <li><strong>KliknutÃ­m na Å™Ã¡dek</strong> ho oznaÄÃ­te nebo zruÅ¡Ã­te oznaÄenÃ­</li>
            <li><strong>KliknutÃ­m na zÃ¡hlavÃ­ sloupce</strong> data seÅ™adÃ­te</li>
            <li><strong>PouÅ¾ijte export tlaÄÃ­tka</strong> pro staÅ¾enÃ­ dat v CSV nebo JSON formÃ¡tu</li>
            <li><strong>OznaÄenÃ¡ data</strong> se automaticky uklÃ¡dajÃ­ a zÅ¯stÃ¡vajÃ­ mezi relacemi</li>
         </ul>
      </div>
   </div>

   <script>
   // Enhanced functionality with the new design
   function exportData(format) {
      if (window.Vue && app) {
         app.exportData(format);
      } else {
         // Fallback export functionality
         window.location.href = '/export?format=' + format;
      }
   }

   // Store stats in localStorage for the home page
   $(document).ready(function() {
      const stats = {
         total: {$totalCount},
         marked: {$markedCount}
      };
      localStorage.setItem('appStats', JSON.stringify(stats));

      // Enhanced row interaction with better visual feedback
      $('tbody tr').hover(
         function() {
            $(this).css('transform', 'scale(1.01)');
         },
         function() {
            $(this).css('transform', 'scale(1)');
         }
      );
   });
   </script>
{/block}