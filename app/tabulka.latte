{layout 'layout.latte'}
{varType array $res}
{varType string $orderBy}
{varType string $direction}
{varType ?string $successMessage}
{varType int $totalCount}
{varType int $markedCount}
{block title}Tabulka dat{/block}
{block body}
   <div class="container">
      {if $successMessage}
         <div class="alert alert-success">
            <strong>✅ Úspěch!</strong> {$successMessage}
         </div>
      {/if}

      <!-- Page Header -->
      <div style="margin: 2rem 0;">
         <h1 style="margin-bottom: 0.5rem;">📊 Správa záznamů</h1>
         <p style="color: var(--gray-600);">Interaktivní tabulka s pokročilými funkcemi pro správu dat</p>
      </div>

      <!-- Statistics Cards -->
      <div class="stats">
         <div class="stat-card">
            <div class="stat-value" id="totalCount">{$totalCount}</div>
            <div class="stat-label">Celkem záznamů</div>
         </div>
         <div class="stat-card">
            <div class="stat-value" id="markedCount">{$markedCount}</div>
            <div class="stat-label">Označeno</div>
         </div>
         <div class="stat-card">
            <div class="stat-value">{round(($markedCount / max($totalCount, 1)) * 100)}%</div>
            <div class="stat-label">Označeno (%)</div>
         </div>
         <div class="stat-card">
            <div class="stat-value">🎯</div>
            <div class="stat-label">Aktivní</div>
         </div>
      </div>

      <!-- Actions Header -->
      <div class="actions-header">
         <div class="actions">
            <a href="/download" class="btn btn-primary">
               📥 Importovat data
            </a>
            <button class="btn btn-secondary" id="clearMarks" v-on:click="clearAllMarks()">
               🗑️ Vymazat označení
            </button>
            <div class="btn-group">
               <button class="btn btn-success btn-sm" onclick="exportData('csv')">
                  💾 Exportovat CSV
               </button>
               <button class="btn btn-success btn-sm" onclick="exportData('json')">
                  💾 Exportovat JSON
               </button>
            </div>
         </div>
         <div class="stats-info hide-mobile">
            <span>Řazeno podle: <strong>{$orderBy}</strong></span>
            <span class="separator">|</span>
            <span>Směr: <strong>{$direction|upper}</strong></span>
         </div>
      </div>

      <!-- Data Table -->
      <div class="card">
         <table class="data-table">
            <thead>
               <tr>
                  <th class="sortable {$orderBy === 'id' ? 'active' : ''}" data-column="id">
                     <a href="?order=id&dir={$orderBy === 'id' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>🔗 ID</span>
                        <span class="sort-icon">{if $orderBy === 'id'}{$direction === 'ASC' ? '↑' : '↓'}{else}↕{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'jmeno' ? 'active' : ''}" data-column="jmeno">
                     <a href="?order=jmeno&dir={$orderBy === 'jmeno' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>👤 Jméno</span>
                        <span class="sort-icon">{if $orderBy === 'jmeno'}{$direction === 'ASC' ? '↑' : '↓'}{else}↕{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'prijmeni' ? 'active' : ''}" data-column="prijmeni">
                     <a href="?order=prijmeni&dir={$orderBy === 'prijmeni' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>📛 Příjmení</span>
                        <span class="sort-icon">{if $orderBy === 'prijmeni'}{$direction === 'ASC' ? '↑' : '↓'}{else}↕{/if}</span>
                     </a>
                  </th>
                  <th class="sortable {$orderBy === 'datum' ? 'active' : ''}" data-column="datum">
                     <a href="?order=datum&dir={$orderBy === 'datum' && $direction === 'ASC' ? 'DESC' : 'ASC'}" style="text-decoration: none; color: inherit; display: flex; align-items: center; justify-content: space-between;">
                        <span>📅 Datum</span>
                        <span class="sort-icon">{if $orderBy === 'datum'}{$direction === 'ASC' ? '↑' : '↓'}{else}↕{/if}</span>
                     </a>
                  </th>
                  <th style="width: 80px; text-align: center;">
                     <span>🎯 Status</span>
                  </th>
               </tr>
            </thead>
            <tbody>
            {foreach $res as $row}
               <tr data-id="{$row['id']}" class="{$row['is_marked'] ? 'row-marked' : ''}" style="cursor: pointer;">
                  <td style="font-weight: 500; color: var(--primary);">#{$row['id']}</td>
                  <td style="font-weight: 500;">{$row['jmeno']}</td>
                  <td>{$row['prijmeni']}</td>
                  <td style="color: var(--gray-600);">
                     {if $row['datum']}
                        {$row['datum']|date:'j.n.Y'}
                     {else}
                        <em style="color: var(--gray-400);">Neuvedeno</em>
                     {/if}
                  </td>
                  <td style="text-align: center;">
                     {if $row['is_marked']}
                        <span style="color: var(--primary); font-size: 1.2em;" title="Označeno">✅</span>
                     {else}
                        <span style="color: var(--gray-300); font-size: 1.2em;" title="Neoznačeno">⭕</span>
                     {/if}
                  </td>
               </tr>
            {/foreach}
            {if count($res) === 0}
               <tr>
                  <td colspan="5" style="text-align: center; padding: 3rem; color: var(--gray-500);">
                     <div style="font-size: 3rem; margin-bottom: 1rem;">📭</div>
                     <strong>Žádná data k zobrazení</strong><br>
                     <em>Importujte data pomocí tlačítka "Importovat data"</em>
                  </td>
               </tr>
            {/if}
            </tbody>
         </table>
      </div>

      <!-- Help Text -->
      <div class="card" style="margin-top: 1.5rem; background-color: var(--gray-50); border-left: 4px solid var(--info);">
         <h4 style="margin-top: 0; color: var(--info);">💡 Nápověda</h4>
         <ul style="margin-bottom: 0; padding-left: 1.5rem;">
            <li><strong>Kliknutím na řádek</strong> ho označíte nebo zrušíte označení</li>
            <li><strong>Kliknutím na záhlaví sloupce</strong> data seřadíte</li>
            <li><strong>Použijte export tlačítka</strong> pro stažení dat v CSV nebo JSON formátu</li>
            <li><strong>Označená data</strong> se automaticky ukládají a zůstávají mezi relacemi</li>
         </ul>
      </div>
   </div>

   <script>
   // Enhanced functionality with the new design
   function exportData(format) {
      if (window.Vue && app) {
         app.exportData(format);
      } else {
         // Fallback export functionality
         window.location.href = '/export?format=' + format;
      }
   }

   // Store stats in localStorage for the home page
   $(document).ready(function() {
      const stats = {
         total: {$totalCount},
         marked: {$markedCount}
      };
      localStorage.setItem('appStats', JSON.stringify(stats));

      // Enhanced row interaction with better visual feedback
      $('tbody tr').hover(
         function() {
            $(this).css('transform', 'scale(1.01)');
         },
         function() {
            $(this).css('transform', 'scale(1)');
         }
      );
   });
   </script>
{/block}